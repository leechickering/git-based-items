---
itemId:sw-257
itemType: Software Item Spec
itemTitle: DataClient
itemFulfills: 
itemHasParent: sw-239
Software item type: SDD
---
### Description
DataClient is the primary interface exposed to consuming applications. It is responsible for invoking the ODataNetworkClient to fetch or update remote data, cache the remote data locally for offline use, validate data, and mapping Mako App Engine Case API models to view models.
 
The API exposed to consuming applications is as follow:
* fetchRemoteProcedures: Makes a single asynchronous call to the backend API to retrieve all past, present, and future cases available to the user. It returns raw OpenAPI-defined models as structs.
* observeProcedures: Used to observe local procedures matching a specific filter. 
	* Parameter filters: The ``CaseFilters`` filters object to apply to the data/request.
	* Returns: A filtered `AsyncStream` containing the `ProcedureListItem`s matching the filter.
	* Note: This stream never finishes on its own.
* fetchProcedures: Used to make an API request to the remote Case API to fetch data, returns only procedures that match a specific filter.
	* Parameter filters: The ``CaseFilters`` filters object to apply to the data/request.
	* Returns: A filtered `AsyncStream` containing a tuple with the request state and the `ProcedureListItem`s matching the filter.
	* Note: This stream never finishes on its own.
* fetchProcedureDetails: Retrieves a procedure by ID. Will not perform a backend API call if the procedure is not available locally.
	* Parameter The procedure's UUID.
	* Returns: An ``AsyncThrowingStream`` with the ``ProcedureDetails``, or an error if the API was unable to retrieve the details. (Eg: An object with the provided ID doesn't exist)
* updateProcedureReviewState: Updates the review state for a procedure with the provided ID. Peforms a backend API call in addition to updating the local database.
	* Parameters:
 		* The procedure's UUID.
		* The desired ``ReviewState`` to set.
	* Note: Calling this method will eventually update the ``fetchProcedures()``, ``observeProcedures()`` and ``fetchProcedureDetails`` streams.
* updateProcedureStatus: Updates the review state for a procedure with the provided ID. Peforms a backend API call in addition to updating the local database.
	* Parameters:
 		* The procedure's UUID
 	    * The desired ``Status`` to set.
	* Note: Calling this method will eventually update the ``fetchProcedures()``, ``observeProcedures()`` and ``fetchProcedureDetails`` streams.
* fetchResourceForProcedure: Retrieves a procedure resource item (such as 3D bone model, CT image) for a procedure with the provided ID. This call may make a network request. 
	The resource object will be replaced with a new one whenever the download progress changes, the file is retrieved (from either disk or the network) and when an error (network or filesystem) occurs. The stream will terminate when the download/filesystem fetch is complete.
	If a resection resource is requested, the DataClient fetches the patient bones (if not already downloaded) and the implants and cutting planes (if not already downloaded) and performs an expensive resection call. This is only done once per procedure. The femur has five cutting planes and tibia only has one. In order to improve performance, both the tibia and femur resections are performed in parallel. All of these steps are invisible to the caller, who awaits a ``ProcedureCombinedResource``. In most cases, the consuming application will request the patient bones, the implants, and the resections as separate resource requests, but in the event that just a resected bone is requested, the DataClient must recursively request the patient bone and implant resources to complete the resection. Separating the resource requests into specific orders does not improve or harm performance in any way.
	* Parameters:
 		* The procedure's UUID
 	   	* The resource type to retrieve (eg, patient bone, implant, resection plane, CT image).
 	* Returns: An ``AsyncStream`` with the ``ProcedureCombinedResource`` containing the state of the resource request.
	* Note: Similar to the fetch procedures call, error handling must be handled by observing the ``downloadStatus`` field. This stream will terminate regardless of whether an error happened or the retrieval was successful. The only way to know why the stream terminated is to observe the download status.
* fetchResourcesForProcedure: Retrieves procedure resources (such as 3D bone models) with the provided IDs. This call may make a network request.     The resource objects will be replaced with a new one whenever the download progress changes, the file is retrieved (from either disk or the network) and when an error (network or filesystem) occurs. The stream will terminate when all the download/filesystem fetch is complete.
	* Parameters:
		* The procedure's UUID
		* The resource type to retrieve (eg, patient bone, implant, resection plane).
	* Returns: An ``AsyncStream`` with the ``ProcedureCombinedResource`` containing the aggregated state of all the resource requests.
	* Note: The ``downloadStatus`` field at any point provides the overall status of all the requests. This stream will terminate after each resource fetch request has been evaluated regardless of whether an error happened or the retrieval was successful.
* deleteAllData: Deletes the case metadata and any downloaded files.
* hasRequiredDisplayableData:  Given a `Procedure`, this block indicates whether it has all the required data to be displayed in the app.
	* Parameters:
		* The ``Procedure`` model to validate.
 	* Returns: A boolean indicating if the ``Procedure`` model is valid or not.
	* Note: The backend API provides all procedures irrespective of the data readiness in RHS system.
* updateCTBrightnessContrast: Updates the CT brightness and contrast view settings for a procedure with the provided ID
	* Parameters:
 		* The procedure's UUID
 	   	* The desired ``Status`` to set.
	* Note: This does not perform a backend API call and only updates the local database.